<!DOCTYPE html>
<html lang="ru" x-data="app">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UI Kit Constructor - Tailwind SPA</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    
    <style>
        [x-cloak] { display: none !important; }
        
        :root {
            --color-primary-50: #eef2ff;
            --color-primary-100: #e0e7ff;
            --color-primary-200: #c7d2fe;
            --color-primary-300: #a5b4fc;
            --color-primary-400: #818cf8;
            --color-primary-500: #6366f1;
            --color-primary-600: #4f46e5;
            --color-primary-700: #4338ca;
            --color-primary-800: #3730a3;
            --color-primary-900: #312e81;
            
            --color-gray-50: #f9fafb;
            --color-gray-100: #f3f4f6;
            --color-gray-200: #e5e7eb;
            --color-gray-300: #d1d5db;
            --color-gray-400: #9ca3af;
            --color-gray-500: #6b7280;
            --color-gray-600: #4b5563;
            --color-gray-700: #374151;
            --color-gray-800: #1f2937;
            --color-gray-900: #111827;
            
            --color-success: #10b981;
            --color-warning: #f59e0b;
            --color-error: #ef4444;
            --color-info: #3b82f6;
        }
        
        .font-sans { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        .font-mono { font-family: 'Roboto Mono', 'Courier New', monospace; }
        
        /* Кастомные утилиты для дизайн-токенов */
        .token-primary-50 { background-color: var(--color-primary-50); }
        .token-primary-100 { background-color: var(--color-primary-100); }
        .token-primary-200 { background-color: var(--color-primary-200); }
        .token-primary-300 { background-color: var(--color-primary-300); }
        .token-primary-400 { background-color: var(--color-primary-400); }
        .token-primary-500 { background-color: var(--color-primary-500); }
        .token-primary-600 { background-color: var(--color-primary-600); }
        .token-primary-700 { background-color: var(--color-primary-700); }
        .token-primary-800 { background-color: var(--color-primary-800); }
        .token-primary-900 { background-color: var(--color-primary-900); }
        
        .token-gray-50 { background-color: var(--color-gray-50); }
        .token-gray-100 { background-color: var(--color-gray-100); }
        .token-gray-200 { background-color: var(--color-gray-200); }
        .token-gray-300 { background-color: var(--color-gray-300); }
        .token-gray-400 { background-color: var(--color-gray-400); }
        .token-gray-500 { background-color: var(--color-gray-500); }
        .token-gray-600 { background-color: var(--color-gray-600); }
        .token-gray-700 { background-color: var(--color-gray-700); }
        .token-gray-800 { background-color: var(--color-gray-800); }
        .token-gray-900 { background-color: var(--color-gray-900); }
        
        .text-token-primary { color: var(--color-primary-600); }
        .bg-token-primary { background-color: var(--color-primary-600); }
        .border-token-primary { border-color: var(--color-primary-600); }
        
        .text-token-success { color: var(--color-success); }
        .bg-token-success { background-color: var(--color-success); }
        
        .text-token-warning { color: var(--color-warning); }
        .bg-token-warning { background-color: var(--color-warning); }
        
        .text-token-error { color: var(--color-error); }
        .bg-token-error { background-color: var(--color-error); }
        
        .text-token-info { color: var(--color-info); }
        .bg-token-info { background-color: var(--color-info); }
    </style>
</head>
<body class="font-sans bg-gray-50 text-gray-800 min-h-screen">
    <!-- Навигация -->
    <nav class="bg-white shadow-md" x-data="{ mobileMenuOpen: false, dropdownOpen: false }">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <!-- Логотип -->
                <div class="flex items-center space-x-3">
                    <button @click="mobileMenuOpen = !mobileMenuOpen" class="md:hidden p-2 rounded-md text-gray-600">
                        <i class="fas fa-bars text-lg"></i>
                    </button>
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-palette text-token-primary text-xl"></i>
                        <span class="text-lg font-semibold">UI Kit Constructor</span>
                        <span class="px-2 py-1 bg-token-primary text-white text-xs rounded-full">v1.0</span>
                    </div>
                </div>
                
                <!-- Десктопная навигация -->
                <div class="hidden md:flex items-center space-x-1">
                    <template x-for="item in navItems" :key="item.id">
                        <a href="#" @click.prevent="$store.app.currentView = item.id" 
                           class="px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors"
                           :class="$store.app.currentView === item.id ? 
                                  'bg-blue-50 text-blue-700 font-medium' : 
                                  'text-gray-600 hover:bg-gray-100'">
                            <i :class="item.icon"></i>
                            <span x-text="item.name"></span>
                        </a>
                    </template>
                    
                    <!-- Действия -->
                    <div class="relative">
                        <button @click="dropdownOpen = !dropdownOpen" 
                                class="px-4 py-2 rounded-lg text-gray-600 hover:bg-gray-100 flex items-center space-x-2">
                            <i class="fas fa-cog"></i>
                            <span>Действия</span>
                        </button>
                        
                        <div x-show="dropdownOpen" @click.outside="dropdownOpen = false"
                             class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-xl border py-2 z-50">
                            <a href="#" @click.prevent="generateCSSFile(); dropdownOpen = false" 
                               class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-file-code mr-2"></i> Генерировать CSS
                            </a>
                            <a href="#" @click.prevent="exportFullSystem(); dropdownOpen = false" 
                               class="block px-4 py-2 text-gray-700 hover:bg-gray-100">
                                <i class="fas fa-download mr-2"></i> Экспорт системы
                            </a>
                            <label class="block px-4 py-2 text-gray-700 hover:bg-gray-100 cursor-pointer">
                                <i class="fas fa-upload mr-2"></i> Импорт системы
                                <input type="file" @change="importSystem" class="hidden" accept=".json">
                            </label>
                            <div class="border-t my-2"></div>
                            <a href="#" @click.prevent="clearAllData(); dropdownOpen = false" 
                               class="block px-4 py-2 text-red-600 hover:bg-red-50">
                                <i class="fas fa-trash mr-2"></i> Очистить данные
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- Профиль -->
                <div class="flex items-center space-x-4">
                    <button class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 flex items-center space-x-2">
                        <i class="fas fa-download"></i>
                        <span class="hidden md:inline">Экспорт</span>
                    </button>
                    <div class="relative">
                        <button class="flex items-center space-x-2 p-2 rounded-lg hover:bg-gray-100">
                            <div class="w-8 h-8 rounded-full bg-token-primary flex items-center justify-center text-white">
                                <i class="fas fa-user"></i>
                            </div>
                            <span class="hidden md:inline">Профиль</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Мобильное меню -->
            <div x-show="mobileMenuOpen" class="md:hidden border-t py-3">
                <div class="space-y-1">
                    <template x-for="item in navItems" :key="item.id">
                        <a href="#" @click.prevent="$store.app.currentView = item.id; mobileMenuOpen = false" 
                           class="block px-4 py-2 rounded-lg"
                           :class="$store.app.currentView === item.id ? 
                                  'bg-blue-50 text-blue-700 font-medium' : 
                                  'text-gray-600 hover:bg-gray-100'">
                            <i :class="item.icon" class="mr-3"></i>
                            <span x-text="item.name"></span>
                        </a>
                    </template>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Основной контент -->
    <main class="py-8">
        <div class="container mx-auto px-4">
            
            <!-- Dashboard -->
            <div x-show="$store.app.currentView === 'dashboard'" x-cloak>
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">Дашборд конструктора UI Kit</h1>
                    <p class="text-gray-600">Создавайте, управляйте и экспортируйте компоненты дизайн-системы</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <!-- Карточка статистики -->
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">Статистика</h3>
                            <i class="fas fa-chart-bar text-blue-500 text-xl"></i>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <p class="text-sm text-gray-500">Всего компонентов</p>
                                <p class="text-2xl font-bold" x-text="$store.components?.list?.length || 0">0</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Последнее обновление</p>
                                <p class="text-lg" x-text="new Date().toLocaleDateString('ru-RU')"></p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Быстрые действия -->
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">Быстрые действия</h3>
                            <i class="fas fa-bolt text-yellow-500 text-xl"></i>
                        </div>
                        <div class="space-y-2">
                            <button @click="$store.app.currentView = 'editor'" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 flex items-center space-x-3">
                                <i class="fas fa-plus"></i>
                                <span>Создать компонент</span>
                            </button>
                            <button @click="$store.app.currentView = 'tokens'" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 flex items-center space-x-3">
                                <i class="fas fa-palette"></i>
                                <span>Настроить токены</span>
                            </button>
                            <button @click="exportAll()" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 flex items-center space-x-3">
                                <i class="fas fa-download"></i>
                                <span>Экспортировать все</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Активность -->
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold">Активность</h3>
                            <i class="fas fa-history text-blue-400 text-xl"></i>
                        </div>
                        <div class="space-y-2">
                            <div class="text-sm">
                                <p class="font-medium">Нет недавней активности</p>
                                <p class="text-gray-500">Начните создавать компоненты</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Последние компоненты -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold">Последние компоненты</h2>
                        <button @click="$store.app.currentView = 'library'" 
                                class="text-blue-600 hover:text-blue-800 flex items-center space-x-2">
                            <span>Все компоненты</span>
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                    
                    <div x-show="$store.components?.list?.length === 0" class="text-center py-8">
                        <i class="fas fa-cube text-4xl text-gray-300 mb-4"></i>
                        <h3 class="text-lg font-medium mb-2">Нет созданных компонентов</h3>
                        <p class="text-gray-500 mb-4">Начните создавать компоненты вашей дизайн-системы</p>
                        <button @click="$store.app.currentView = 'editor'" 
                                class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            <i class="fas fa-plus mr-2"></i> Создать первый компонент
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <template x-for="component in $store.components?.list?.slice(0, 3)" :key="component.id">
                            <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                                <div class="flex justify-between items-start mb-3">
                                    <div>
                                        <h4 class="font-semibold" x-text="component.name"></h4>
                                        <div class="flex items-center space-x-2 mt-1">
                                            <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full" 
                                                  x-text="component.type"></span>
                                            <span class="px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded-full" 
                                                  x-text="component.version"></span>
                                        </div>
                                    </div>
                                    <button @click="$store.components.currentComponent = component; $store.app.currentView = 'editor'" 
                                            class="text-gray-400 hover:text-blue-600">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </div>
                                
                                <!-- Превью компонента -->
                                <div class="mb-3 p-3 bg-gray-50 rounded border">
                                    <template x-if="component.type === 'button'">
                                        <button class="px-4 py-2 bg-blue-600 text-white rounded-lg"
                                                x-text="component.variants[0]?.properties?.text || 'Кнопка'">
                                        </button>
                                    </template>
                                    
                                    <template x-if="component.type === 'card'">
                                        <div class="p-4 bg-white rounded-lg shadow">
                                            <div class="font-medium mb-2">Пример карточки</div>
                                            <div class="text-sm text-gray-600" x-text="component.type"></div>
                                        </div>
                                    </template>
                                </div>
                                
                                <div class="text-sm text-gray-500 flex justify-between">
                                    <span x-text="component.variants?.length + ' вариантов'"></span>
                                    <span x-text="formatDate(component.updatedAt)"></span>
                                </div>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
            
            <!-- Редактор компонентов -->
            <div x-show="$store.app.currentView === 'editor'" x-cloak x-data="editor">
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">Редактор компонентов</h1>
                    <p class="text-gray-600">Создавайте и редактируйте компоненты вашей дизайн-системы</p>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Панель создания -->
                    <div class="bg-white rounded-xl shadow-md p-6 lg:col-span-1">
                        <h3 class="text-lg font-semibold mb-4">Создать компонент</h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Тип компонента</label>
                                <select x-model="newComponentType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">Выберите тип</option>
                                    <template x-for="type in $store.components.componentTypes" :key="type">
                                        <option :value="type" x-text="type.charAt(0).toUpperCase() + type.slice(1)"></option>
                                    </template>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Название компонента</label>
                                <input type="text" x-model="newComponentName" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500" 
                                       placeholder="Например, Основная кнопка">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Категория</label>
                                <select x-model="newComponentCategory" 
                                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="basic">Базовые</option>
                                    <option value="forms">Формы</option>
                                    <option value="layout">Макет</option>
                                    <option value="feedback">Обратная связь</option>
                                    <option value="navigation">Навигация</option>
                                </select>
                            </div>
                            
                            <button @click="createNewComponent()" 
                                    :disabled="!newComponentType"
                                    class="w-full px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2">
                                <i class="fas fa-plus"></i>
                                <span>Создать компонент</span>
                            </button>
                        </div>
                        
                        <!-- Список компонентов -->
                        <div class="mt-8">
                            <h4 class="font-medium text-gray-700 mb-3">Мои компоненты</h4>
                            <div class="space-y-2 max-h-60 overflow-y-auto">
                                <template x-for="component in $store.components.list" :key="component.id">
                                    <div @click="$store.components.currentComponent = component"
                                         class="p-3 border rounded-lg cursor-pointer transition-colors"
                                         :class="$store.components.currentComponent?.id === component.id ? 
                                                'border-blue-500 bg-blue-50' : 
                                                'border-gray-200 hover:border-blue-300'">
                                        <div class="flex justify-between items-center">
                                            <div>
                                                <p class="font-medium" x-text="component.name"></p>
                                                <p class="text-xs text-gray-500" x-text="component.type"></p>
                                            </div>
                                            <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full" 
                                                  x-text="component.version"></span>
                                        </div>
                                    </div>
                                </template>
                                
                                <div x-show="$store.components.list.length === 0" class="text-center py-4 text-gray-500">
                                    <i class="fas fa-inbox text-2xl mb-2"></i>
                                    <p>Нет созданных компонентов</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Редактор -->
                    <div class="bg-white rounded-xl shadow-md p-6 lg:col-span-2" x-show="$store.components.currentComponent">
                        <div class="flex justify-between items-center mb-6">
                            <div>
                                <h3 class="text-xl font-bold" x-text="$store.components.currentComponent?.name"></h3>
                                <p class="text-gray-500" x-text="`Тип: ${$store.components.currentComponent?.type}`"></p>
                            </div>
                            
                            <div class="flex space-x-2">
                                <button @click="saveComponent()" 
                                        class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center space-x-2">
                                    <i class="fas fa-save"></i>
                                    <span>Сохранить</span>
                                </button>
                                <button @click="exportComponent($store.components.currentComponent)" 
                                        class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 flex items-center space-x-2">
                                    <i class="fas fa-download"></i>
                                    <span>Экспорт</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Вкладки редактора -->
                        <div class="border-b border-gray-200 mb-6">
                            <div class="flex space-x-4">
                                <button @click="editorTab = 'preview'" 
                                        class="pb-2 px-1 border-b-2 font-medium"
                                        :class="editorTab === 'preview' ? 'border-blue-500 text-blue-700' : 'border-transparent text-gray-500 hover:text-gray-700'">
                                    <i class="fas fa-eye mr-2"></i> Предпросмотр
                                </button>
                                <button @click="editorTab = 'properties'" 
                                        class="pb-2 px-1 border-b-2 font-medium"
                                        :class="editorTab === 'properties' ? 'border-blue-500 text-blue-700' : 'border-transparent text-gray-500 hover:text-gray-700'">
                                    <i class="fas fa-sliders-h mr-2"></i> Свойства
                                </button>
                                <button @click="editorTab = 'code'" 
                                        class="pb-2 px-1 border-b-2 font-medium"
                                        :class="editorTab === 'code' ? 'border-blue-500 text-blue-700' : 'border-transparent text-gray-500 hover:text-gray-700'">
                                    <i class="fas fa-code mr-2"></i> Код
                                </button>
                                <button @click="editorTab = 'variants'" 
                                        class="pb-2 px-1 border-b-2 font-medium"
                                        :class="editorTab === 'variants' ? 'border-blue-500 text-blue-700' : 'border-transparent text-gray-500 hover:text-gray-700'">
                                    <i class="fas fa-layer-group mr-2"></i> Варианты
                                </button>
                            </div>
                        </div>
                        
                        <!-- Контент вкладок -->
                        <div x-show="editorTab === 'preview'">
                            <div class="p-6 border border-gray-200 rounded-lg bg-gray-50 mb-4">
                                <h4 class="font-semibold mb-3">Предпросмотр компонента</h4>
                                
                                <div id="componentPreview" class="p-4 bg-white rounded border">
                                    <template x-if="$store.components.currentComponent?.type === 'button'">
                                        <button :style="{
                                            backgroundColor: $store.components.currentComponent?.variants[0]?.properties?.bgColor || 'var(--color-primary-600)',
                                            color: $store.components.currentComponent?.variants[0]?.properties?.textColor || 'white',
                                            padding: $store.components.currentComponent?.variants[0]?.properties?.padding || '0.5rem 1rem',
                                            borderRadius: $store.components.currentComponent?.variants[0]?.properties?.borderRadius || '0.375rem',
                                            fontSize: $store.components.currentComponent?.variants[0]?.properties?.fontSize || '0.875rem',
                                            fontWeight: $store.components.currentComponent?.variants[0]?.properties?.fontWeight || '500',
                                            border: 'none',
                                            cursor: 'pointer'
                                        }" x-text="$store.components.currentComponent?.variants[0]?.properties?.text || 'Кнопка'">
                                        </button>
                                    </template>
                                    
                                    <template x-if="$store.components.currentComponent?.type === 'card'">
                                        <div :style="{
                                            backgroundColor: $store.components.currentComponent?.variants[0]?.properties?.bgColor || 'white',
                                            padding: $store.components.currentComponent?.variants[0]?.properties?.padding || '1.5rem',
                                            borderRadius: $store.components.currentComponent?.variants[0]?.properties?.borderRadius || '0.75rem',
                                            boxShadow: $store.components.currentComponent?.variants[0]?.properties?.shadow || '0 4px 6px -1px rgba(0, 0, 0, 0.1)'
                                        }">
                                            <h4 class="font-bold mb-2">Заголовок карточки</h4>
                                            <p class="text-gray-600">Пример содержимого карточки</p>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                        
                        <div x-show="editorTab === 'properties'" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Название компонента</label>
                                <input type="text" x-model="$store.components.currentComponent.name" 
                                       @change="$store.components.updateComponent($store.components.currentComponent.id, { name: $event.target.value })"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                            
                            <template x-if="$store.components.currentComponent?.type === 'button'">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Текст кнопки</label>
                                        <input type="text" x-model="$store.components.currentComponent.variants[0].properties.text"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Цвет фона</label>
                                        <input type="color" x-model="$store.components.currentComponent.variants[0].properties.bgColor"
                                               class="w-full h-10 p-1 border border-gray-300 rounded-lg">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Цвет текста</label>
                                        <input type="color" x-model="$store.components.currentComponent.variants[0].properties.textColor"
                                               class="w-full h-10 p-1 border border-gray-300 rounded-lg">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Скругление</label>
                                        <select x-model="$store.components.currentComponent.variants[0].properties.borderRadius" 
                                                class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                            <option value="0">Без скругления</option>
                                            <option value="0.25rem">Маленькое</option>
                                            <option value="0.375rem">Среднее</option>
                                            <option value="0.5rem">Большое</option>
                                            <option value="9999px">Полное</option>
                                        </select>
                                    </div>
                                </div>
                            </template>
                        </div>
                        
                        <div x-show="editorTab === 'code'" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">HTML</label>
                                <textarea x-model="$store.components.currentComponent.variants[0].html" 
                                          class="w-full px-3 py-2 border border-gray-300 rounded-lg font-mono text-sm h-32"
                                          placeholder="HTML код компонента"></textarea>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">CSS</label>
                                <textarea x-model="$store.components.currentComponent.variants[0].css" 
                                          class="w-full px-3 py-2 border border-gray-300 rounded-lg font-mono text-sm h-32"
                                          placeholder="CSS стили компонента"></textarea>
                            </div>
                        </div>
                        
                        <div x-show="editorTab === 'variants'">
                            <div class="flex justify-between items-center mb-4">
                                <h4 class="font-semibold">Варианты компонента</h4>
                                <button @click="addVariant()" 
                                        class="px-3 py-1 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 text-sm">
                                    <i class="fas fa-plus mr-1"></i> Добавить вариант
                                </button>
                            </div>
                            
                            <div class="space-y-3">
                                <template x-for="(variant, index) in $store.components.currentComponent?.variants" :key="index">
                                    <div class="p-3 border border-gray-200 rounded-lg">
                                        <div class="flex justify-between items-center mb-2">
                                            <div class="flex items-center space-x-2">
                                                <span class="font-medium" x-text="variant.name"></span>
                                                <span x-show="index === 0" 
                                                      class="px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full">
                                                    По умолчанию
                                                </span>
                                            </div>
                                            
                                            <div class="flex space-x-2">
                                                <button @click="editVariant(index)" 
                                                        class="text-gray-400 hover:text-blue-600">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <button x-show="index > 0" @click="removeVariant(index)" 
                                                        class="text-gray-400 hover:text-red-600">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                        
                                        <div class="text-sm text-gray-500">
                                            Свойств: <span x-text="Object.keys(variant.properties || {}).length"></span>
                                        </div>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Пустое состояние редактора -->
                    <div x-show="!$store.components.currentComponent" class="lg:col-span-2 bg-white rounded-xl shadow-md p-12 flex flex-col items-center justify-center">
                        <i class="fas fa-magic text-4xl text-gray-300 mb-4"></i>
                        <h3 class="text-lg font-medium mb-2">Выберите компонент</h3>
                        <p class="text-gray-500 mb-6 text-center">Выберите существующий компонент или создайте новый</p>
                        <button @click="$store.app.currentView = 'dashboard'" 
                                class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center space-x-2">
                            <i class="fas fa-arrow-left"></i>
                            <span>Вернуться на дашборд</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Библиотека компонентов -->
            <div x-show="$store.app.currentView === 'library'" x-cloak x-data="library">
                <div class="mb-8">
                    <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
                        <div>
                            <h1 class="text-3xl font-bold text-gray-900 mb-2">Библиотека компонентов</h1>
                            <p class="text-gray-600">Все созданные компоненты вашей дизайн-системы</p>
                        </div>
                        
                        <div class="flex space-x-2 mt-4 md:mt-0">
                            <button @click="exportLibrary()" 
                                    class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 flex items-center space-x-2">
                                <i class="fas fa-download"></i>
                                <span>Экспорт библиотеки</span>
                            </button>
                            <button @click="$store.app.currentView = 'editor'" 
                                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center space-x-2">
                                <i class="fas fa-plus"></i>
                                <span>Новый компонент</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Фильтры и поиск -->
                <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Поиск</label>
                            <div class="relative">
                                <input type="text" x-model="searchQuery"
                                       placeholder="Название или тип..."
                                       class="w-full pl-10 pr-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Тип компонента</label>
                            <select x-model="filterType" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Все типы</option>
                                <template x-for="type in $store.components.componentTypes" :key="type">
                                    <option :value="type" x-text="type.charAt(0).toUpperCase() + type.slice(1)"></option>
                                </template>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Категория</label>
                            <select x-model="filterCategory" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="">Все категории</option>
                                <option value="basic">Базовые</option>
                                <option value="forms">Формы</option>
                                <option value="layout">Макет</option>
                                <option value="feedback">Обратная связь</option>
                                <option value="navigation">Навигация</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Сортировка</label>
                            <select x-model="sortBy" 
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                <option value="name">По названию</option>
                                <option value="createdAt">По дате создания</option>
                                <option value="updatedAt">По дате обновления</option>
                                <option value="type">По типу</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Список компонентов -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <template x-for="component in filteredComponents" :key="component.id">
                        <div class="bg-white rounded-xl shadow-md hover:shadow-lg transition-shadow p-5">
                            <div class="flex justify-between items-start mb-4">
                                <div>
                                    <h3 class="font-bold text-lg mb-1" x-text="component.name"></h3>
                                    <div class="flex items-center space-x-2">
                                        <span class="px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full" 
                                              x-text="component.type"></span>
                                        <span class="px-2 py-1 bg-gray-100 text-gray-800 text-xs rounded-full" 
                                              x-text="getCategoryName(component.category)"></span>
                                    </div>
                                </div>
                                
                                <div class="flex space-x-1 opacity-0 group-hover:opacity-100">
                                    <button @click="editComponent(component)" 
                                            class="p-1 text-gray-400 hover:text-blue-600">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button @click="exportComponent(component)"
                                            class="p-1 text-gray-400 hover:text-blue-600">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <button @click="deleteComponent(component)"
                                            class="p-1 text-gray-400 hover:text-red-600">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Превью компонента -->
                            <div class="mb-4 p-4 bg-gray-50 rounded-lg border">
                                <template x-if="component.type === 'button'">
                                    <button class="px-4 py-2 bg-blue-600 text-white rounded-lg"
                                            x-text="component.variants[0]?.properties?.text || 'Кнопка'">
                                    </button>
                                </template>
                                
                                <template x-if="component.type === 'card'">
                                    <div class="p-4 bg-white rounded-lg shadow">
                                        <div class="font-medium mb-2">Пример карточки</div>
                                        <div class="text-sm text-gray-600" x-text="component.type"></div>
                                    </div>
                                </template>
                            </div>
                            
                            <div class="flex justify-between text-sm text-gray-500">
                                <div class="flex items-center space-x-1">
                                    <i class="fas fa-layer-group"></i>
                                    <span x-text="component.variants?.length || 0"></span> вариантов
                                </div>
                                <div class="flex items-center space-x-1">
                                    <i class="fas fa-clock"></i>
                                    <span x-text="formatDate(component.updatedAt)"></span>
                                </div>
                            </div>
                            
                            <div class="mt-4 pt-4 border-t">
                                <button @click="editComponent(component)" 
                                        class="w-full px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 flex items-center justify-center space-x-2">
                                    <i class="fas fa-edit"></i>
                                    <span>Редактировать</span>
                                </button>
                            </div>
                        </div>
                    </template>
                    
                    <!-- Пустое состояние -->
                    <div x-show="filteredComponents.length === 0" class="md:col-span-2 lg:col-span-3">
                        <div class="bg-white rounded-xl shadow-md p-12 text-center">
                            <i class="fas fa-box-open text-4xl text-gray-300 mb-4"></i>
                            <h3 class="text-lg font-medium mb-2">Библиотека пуста</h3>
                            <p class="text-gray-500 mb-6" 
                               x-text="searchQuery || filterType || filterCategory ? 
                               'Нет компонентов, соответствующих фильтрам' : 
                               'Создайте первый компонент, чтобы начать работу'"></p>
                            <button @click="$store.app.currentView = 'editor'" 
                                    class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                                <i class="fas fa-plus mr-2"></i> Создать компонент
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Пагинация -->
                <div x-show="filteredComponents.length > 0" class="mt-8 flex flex-col md:flex-row items-center justify-between">
                    <div class="text-sm text-gray-500 mb-4 md:mb-0">
                        Показано <span x-text="filteredComponents.length"></span> из 
                        <span x-text="$store.components.list.length"></span> компонентов
                    </div>
                    
                    <div class="flex space-x-2">
                        <button @click="currentPage--" :disabled="currentPage === 1"
                                class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <span class="px-4 py-2">Страница <span x-text="currentPage"></span></span>
                        <button @click="currentPage++"
                                class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Дизайн-токены -->
            <div x-show="$store.app.currentView === 'tokens'" x-cloak>
                <div class="mb-8">
                    <h1 class="text-3xl font-bold text-gray-900 mb-2">Дизайн-токены</h1>
                    <p class="text-gray-600">Управление цветами, типографикой и другими переменными дизайн-системы</p>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-lg font-semibold mb-4">Цветовая палитра</h3>
                        
                        <div class="space-y-6">
                            <div>
                                <h4 class="font-medium text-blue-700 mb-3">Основные цвета</h4>
                                <div class="grid grid-cols-5 gap-2">
                                    <template x-for="shade in ['50', '100', '200', '300', '400', '500', '600', '700', '800', '900']" :key="shade">
                                        <div class="text-center">
                                            <div class="w-full h-12 rounded mb-1 border border-gray-200" 
                                                 :class="`token-primary-${shade}`"></div>
                                            <span class="text-xs" x-text="shade"></span>
                                        </div>
                                    </template>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="font-medium text-gray-700 mb-3">Нейтральные цвета</h4>
                                <div class="grid grid-cols-5 gap-2">
                                    <template x-for="shade in ['50', '100', '200', '300', '400', '500', '600', '700', '800', '900']" :key="shade">
                                        <div class="text-center">
                                            <div class="w-full h-12 rounded mb-1 border border-gray-200" 
                                                 :class="`token-gray-${shade}`"></div>
                                            <span class="text-xs" x-text="shade"></span>
                                        </div>
                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-lg font-semibold mb-4">Типографика</h3>
                        
                        <div class="space-y-6">
                            <div>
                                <h4 class="font-medium mb-3">Размеры шрифтов</h4>
                                <div class="space-y-4">
                                    <div>
                                        <div class="flex justify-between text-sm text-gray-600 mb-1">
                                            <span>--font-size-xs</span>
                                            <span>0.75rem (12px)</span>
                                        </div>
                                        <p class="text-xs">Пример текста размером xs</p>
                                    </div>
                                    <div>
                                        <div class="flex justify-between text-sm text-gray-600 mb-1">
                                            <span>--font-size-sm</span>
                                            <span>0.875rem (14px)</span>
                                        </div>
                                        <p class="text-sm">Пример текста размером sm</p>
                                    </div>
                                    <div>
                                        <div class="flex justify-between text-sm text-gray-600 mb-1">
                                            <span>--font-size-base</span>
                                            <span>1rem (16px)</span>
                                        </div>
                                        <p>Пример текста размером base</p>
                                    </div>
                                    <div>
                                        <div class="flex justify-between text-sm text-gray-600 mb-1">
                                            <span>--font-size-lg</span>
                                            <span>1.125rem (18px)</span>
                                        </div>
                                        <p class="text-lg">Пример текста размером lg</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="font-medium mb-3">Насыщенность шрифтов</h4>
                                <div class="space-y-2">
                                    <p class="font-light">Текст с насыщенностью light</p>
                                    <p class="font-normal">Текст с насыщенностью normal</p>
                                    <p class="font-medium">Текст с насыщенностью medium</p>
                                    <p class="font-semibold">Текст с насыщенностью semibold</p>
                                    <p class="font-bold">Текст с насыщенностью bold</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Остальные вьюшки (versions, collaboration) -->
            <!-- Для краткости я оставляю структуру, но не разворачиваю полный код -->
            <div x-show="$store.app.currentView === 'versions'" x-cloak>
                <div class="bg-white rounded-xl shadow-md p-8 text-center">
                    <i class="fas fa-code-branch text-4xl text-blue-500 mb-4"></i>
                    <h2 class="text-2xl font-bold mb-2">Управление версиями</h2>
                    <p class="text-gray-600 mb-6">Скоро здесь будет система управления версиями ваших компонентов</p>
                    <button @click="$store.app.currentView = 'dashboard'" 
                            class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        Вернуться на дашборд
                    </button>
                </div>
            </div>
            
            <div x-show="$store.app.currentView === 'collaboration'" x-cloak>
                <div class="bg-white rounded-xl shadow-md p-8 text-center">
                    <i class="fas fa-users text-4xl text-green-500 mb-4"></i>
                    <h2 class="text-2xl font-bold mb-2">Коллаборация</h2>
                    <p class="text-gray-600 mb-6">Скоро здесь будет система совместной работы над компонентами</p>
                    <button @click="$store.app.currentView = 'dashboard'" 
                            class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        Вернуться на дашборд
                    </button>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Уведомления -->
    <div id="notifications" class="fixed top-4 right-4 z-50"></div>

    <script>
        document.addEventListener('alpine:init', () => {
            // Навигационные элементы
            Alpine.data('app', () => ({
                navItems: [
                    { id: 'dashboard', name: 'Дашборд', icon: 'fas fa-home' },
                    { id: 'editor', name: 'Редактор', icon: 'fas fa-edit' },
                    { id: 'library', name: 'Библиотека', icon: 'fas fa-boxes' },
                    { id: 'tokens', name: 'Токены', icon: 'fas fa-swatchbook' },
                    { id: 'versions', name: 'Версии', icon: 'fas fa-code-branch' },
                    { id: 'collaboration', name: 'Коллаборация', icon: 'fas fa-users' }
                ],
                
                generateCSSFile() {
                    const tokens = Alpine.store('app').designTokens;
                    let css = `/* UI Kit CSS - Generated ${new Date().toLocaleDateString()} */\n\n`;
                    
                    css += ':root {\n';
                    Object.entries(tokens.colors.primary).forEach(([shade, value]) => {
                        css += `  --color-primary-${shade}: ${value};\n`;
                    });
                    
                    Object.entries(tokens.colors.gray).forEach(([shade, value]) => {
                        css += `  --color-gray-${shade}: ${value};\n`;
                    });
                    
                    css += '}\n\n';
                    
                    const blob = new Blob([css], { type: 'text/css' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'ui-kit-styles.css';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    this.showNotification('CSS файл сгенерирован', 'success');
                },
                
                exportFullSystem() {
                    const systemData = {
                        metadata: {
                            exportedAt: new Date().toISOString(),
                            version: '1.0.0',
                            system: 'UI Kit Constructor'
                        },
                        designTokens: Alpine.store('app').designTokens,
                        components: Alpine.store('components').list
                    };
                    
                    const blob = new Blob([JSON.stringify(systemData, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `ui-kit-system-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    this.showNotification('Система экспортирована', 'success');
                },
                
                importSystem(event) {
                    const file = event.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = JSON.parse(e.target.result);
                            
                            if (data.designTokens) {
                                Alpine.store('app').designTokens = data.designTokens;
                            }
                            
                            if (data.components) {
                                Alpine.store('components').list = data.components;
                                Alpine.store('components').saveToLocalStorage();
                            }
                            
                            this.showNotification('Система импортирована', 'success');
                            setTimeout(() => location.reload(), 1000);
                        } catch (error) {
                            this.showNotification('Ошибка импорта', 'error');
                        }
                    };
                    reader.readAsText(file);
                },
                
                clearAllData() {
                    if (confirm('ВНИМАНИЕ: Это удалит все данные системы. Продолжить?')) {
                        localStorage.clear();
                        location.reload();
                    }
                },
                
                showNotification(message, type = 'info') {
                    const notification = document.createElement('div');
                    notification.className = `p-4 rounded-lg shadow-lg text-white mb-2 ${
                        type === 'success' ? 'bg-green-500' :
                        type === 'error' ? 'bg-red-500' :
                        type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500'
                    }`;
                    notification.innerHTML = `
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation' : 'info'}"></i>
                            <span>${message}</span>
                        </div>
                    `;
                    
                    document.getElementById('notifications').appendChild(notification);
                    
                    setTimeout(() => {
                        notification.style.transition = 'opacity 0.3s';
                        notification.style.opacity = '0';
                        setTimeout(() => notification.remove(), 300);
                    }, 3000);
                }
            }));
            
            // Глобальное состояние
            Alpine.store('app', {
                currentView: 'dashboard',
                
                designTokens: {
                    colors: {
                        primary: {
                            '50': '#eef2ff',
                            '100': '#e0e7ff',
                            '200': '#c7d2fe',
                            '300': '#a5b4fc',
                            '400': '#818cf8',
                            '500': '#6366f1',
                            '600': '#4f46e5',
                            '700': '#4338ca',
                            '800': '#3730a3',
                            '900': '#312e81'
                        },
                        gray: {
                            '50': '#f9fafb',
                            '100': '#f3f4f6',
                            '200': '#e5e7eb',
                            '300': '#d1d5db',
                            '400': '#9ca3af',
                            '500': '#6b7280',
                            '600': '#4b5563',
                            '700': '#374151',
                            '800': '#1f2937',
                            '900': '#111827'
                        }
                    }
                }
            });
            
            // Компоненты
            Alpine.store('components', {
                list: [],
                currentComponent: null,
                componentTypes: ['button', 'input', 'card', 'alert', 'badge', 'avatar', 'modal'],
                
                createComponent(type = 'button') {
                    const baseComponents = {
                        button: {
                            id: Date.now(),
                            name: 'Новая кнопка',
                            type: 'button',
                            category: 'basic',
                            version: '1.0.0',
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString(),
                            variants: [
                                {
                                    name: 'primary',
                                    properties: {
                                        text: 'Кнопка',
                                        bgColor: 'var(--color-primary-600)',
                                        textColor: 'white',
                                        padding: '0.5rem 1rem',
                                        borderRadius: '0.375rem',
                                        fontSize: '0.875rem',
                                        fontWeight: '500'
                                    },
                                    html: '<button class="px-4 py-2 bg-blue-600 text-white rounded-lg">Кнопка</button>',
                                    css: `.btn-primary { background: var(--color-primary-600); color: white; }`
                                }
                            ]
                        },
                        card: {
                            id: Date.now() + 1,
                            name: 'Новая карточка',
                            type: 'card',
                            category: 'layout',
                            version: '1.0.0',
                            createdAt: new Date().toISOString(),
                            updatedAt: new Date().toISOString(),
                            variants: [
                                {
                                    name: 'default',
                                    properties: {
                                        bgColor: 'white',
                                        padding: '1.5rem',
                                        borderRadius: '0.75rem',
                                        shadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)'
                                    },
                                    html: '<div class="p-6 bg-white rounded-xl shadow">Содержимое карточки</div>',
                                    css: `.card { background: white; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }`
                                }
                            ]
                        }
                    };
                    
                    const component = baseComponents[type] || {
                        id: Date.now(),
                        name: `Новый ${type}`,
                        type: type,
                        category: 'basic',
                        version: '1.0.0',
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString(),
                        variants: []
                    };
                    
                    this.list.push(component);
                    this.currentComponent = component;
                    this.saveToLocalStorage();
                    
                    return component;
                },
                
                updateComponent(id, updates) {
                    const index = this.list.findIndex(c => c.id === id);
                    if (index !== -1) {
                        this.list[index] = { ...this.list[index], ...updates, updatedAt: new Date().toISOString() };
                        if (this.currentComponent && this.currentComponent.id === id) {
                            this.currentComponent = this.list[index];
                        }
                        this.saveToLocalStorage();
                    }
                },
                
                addVariant(componentId, variantName) {
                    const component = this.list.find(c => c.id === componentId);
                    if (component && component.variants.length > 0) {
                        const baseVariant = { ...component.variants[0] };
                        baseVariant.name = variantName;
                        component.variants.push(baseVariant);
                        this.updateComponent(componentId, { variants: component.variants });
                    }
                },
                
                removeVariant(componentId, variantName) {
                    const component = this.list.find(c => c.id === componentId);
                    if (component && component.variants.length > 1) {
                        component.variants = component.variants.filter(v => v.name !== variantName);
                        this.updateComponent(componentId, { variants: component.variants });
                    }
                },
                
                saveToLocalStorage() {
                    localStorage.setItem('uiKitComponents', JSON.stringify(this.list));
                },
                
                loadFromLocalStorage() {
                    const saved = localStorage.getItem('uiKitComponents');
                    if (saved) {
                        this.list = JSON.parse(saved);
                    }
                },
                
                init() {
                    this.loadFromLocalStorage();
                }
            });
            
            // Инициализация компонентов
            Alpine.store('components').init();
            
            // Редактор
            Alpine.data('editor', () => ({
                newComponentType: '',
                newComponentName: '',
                newComponentCategory: 'basic',
                editorTab: 'preview',
                
                createNewComponent() {
                    if (!this.newComponentType) return;
                    
                    const component = Alpine.store('components').createComponent(this.newComponentType);
                    
                    if (this.newComponentName) {
                        Alpine.store('components').updateComponent(component.id, { 
                            name: this.newComponentName,
                            category: this.newComponentCategory
                        });
                    }
                    
                    this.newComponentType = '';
                    this.newComponentName = '';
                    this.newComponentCategory = 'basic';
                    this.editorTab = 'properties';
                },
                
                saveComponent() {
                    const component = Alpine.store('components').currentComponent;
                    if (component) {
                        Alpine.store('components').updateComponent(component.id, {
                            updatedAt: new Date().toISOString()
                        });
                        this.showNotification('Компонент сохранен', 'success');
                    }
                },
                
                addVariant() {
                    const component = Alpine.store('components').currentComponent;
                    if (component) {
                        const variantName = prompt('Введите название варианта:');
                        if (variantName) {
                            Alpine.store('components').addVariant(component.id, variantName);
                            this.showNotification('Вариант добавлен', 'success');
                        }
                    }
                },
                
                removeVariant(index) {
                    const component = Alpine.store('components').currentComponent;
                    if (component && component.variants[index]) {
                        if (confirm(`Удалить вариант "${component.variants[index].name}"?`)) {
                            Alpine.store('components').removeVariant(component.id, component.variants[index].name);
                            this.showNotification('Вариант удален', 'warning');
                        }
                    }
                },
                
                editVariant(index) {
                    const component = Alpine.store('components').currentComponent;
                    if (component && component.variants[index]) {
                        const newName = prompt('Введите новое название варианта:', component.variants[index].name);
                        if (newName) {
                            component.variants[index].name = newName;
                            Alpine.store('components').updateComponent(component.id, {
                                variants: component.variants
                            });
                        }
                    }
                },
                
                exportComponent(component) {
                    const exportData = {
                        name: component.name,
                        type: component.type,
                        version: component.version,
                        variants: component.variants
                    };
                    
                    const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${component.name.toLowerCase().replace(/\s+/g, '-')}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    this.showNotification('Компонент экспортирован', 'success');
                },
                
                showNotification(message, type = 'info') {
                    const notification = document.createElement('div');
                    notification.className = `p-4 rounded-lg shadow-lg text-white mb-2 ${
                        type === 'success' ? 'bg-green-500' :
                        type === 'error' ? 'bg-red-500' :
                        type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500'
                    }`;
                    notification.innerHTML = `
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation' : 'info'}"></i>
                            <span>${message}</span>
                        </div>
                    `;
                    
                    document.getElementById('notifications').appendChild(notification);
                    
                    setTimeout(() => {
                        notification.style.transition = 'opacity 0.3s';
                        notification.style.opacity = '0';
                        setTimeout(() => notification.remove(), 300);
                    }, 3000);
                }
            }));
            
            // Библиотека
            Alpine.data('library', () => ({
                searchQuery: '',
                filterType: '',
                filterCategory: '',
                sortBy: 'name',
                currentPage: 1,
                itemsPerPage: 9,
                
                get filteredComponents() {
                    let components = [...Alpine.store('components').list];
                    
                    if (this.searchQuery) {
                        const query = this.searchQuery.toLowerCase();
                        components = components.filter(c => 
                            c.name.toLowerCase().includes(query) || 
                            c.type.toLowerCase().includes(query)
                        );
                    }
                    
                    if (this.filterType) {
                        components = components.filter(c => c.type === this.filterType);
                    }
                    
                    if (this.filterCategory) {
                        components = components.filter(c => c.category === this.filterCategory);
                    }
                    
                    components.sort((a, b) => {
                        if (this.sortBy === 'name') return a.name.localeCompare(b.name);
                        if (this.sortBy === 'createdAt') return new Date(b.createdAt) - new Date(a.createdAt);
                        if (this.sortBy === 'updatedAt') return new Date(b.updatedAt) - new Date(a.updatedAt);
                        if (this.sortBy === 'type') return a.type.localeCompare(b.type);
                        return 0;
                    });
                    
                    const start = (this.currentPage - 1) * this.itemsPerPage;
                    return components.slice(start, start + this.itemsPerPage);
                },
                
                getCategoryName(category) {
                    const names = {
                        'basic': 'Базовые',
                        'forms': 'Формы',
                        'layout': 'Макет',
                        'feedback': 'Обратная связь',
                        'navigation': 'Навигация'
                    };
                    return names[category] || category;
                },
                
                formatDate(dateString) {
                    return new Date(dateString).toLocaleDateString('ru-RU');
                },
                
                editComponent(component) {
                    Alpine.store('components').currentComponent = component;
                    Alpine.store('app').currentView = 'editor';
                },
                
                exportComponent(component) {
                    const exportData = {
                        name: component.name,
                        type: component.type,
                        version: component.version,
                        variants: component.variants
                    };
                    
                    const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${component.name.toLowerCase().replace(/\s+/g, '-')}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    this.showNotification('Компонент экспортирован', 'success');
                },
                
                deleteComponent(component) {
                    if (confirm(`Удалить компонент "${component.name}"?`)) {
                        const store = Alpine.store('components');
                        store.list = store.list.filter(c => c.id !== component.id);
                        if (store.currentComponent?.id === component.id) {
                            store.currentComponent = null;
                        }
                        store.saveToLocalStorage();
                        this.showNotification('Компонент удален', 'warning');
                    }
                },
                
                exportLibrary() {
                    const libraryData = {
                        metadata: {
                            exportedAt: new Date().toISOString(),
                            version: '1.0',
                            componentCount: Alpine.store('components').list.length
                        },
                        designTokens: Alpine.store('app').designTokens,
                        components: Alpine.store('components').list
                    };
                    
                    const blob = new Blob([JSON.stringify(libraryData, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `ui-kit-library-${new Date().toISOString().split('T')[0]}.json`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    this.showNotification('Библиотека экспортирована', 'success');
                },
                
                showNotification(message, type = 'info') {
                    const notification = document.createElement('div');
                    notification.className = `p-4 rounded-lg shadow-lg text-white mb-2 ${
                        type === 'success' ? 'bg-green-500' :
                        type === 'error' ? 'bg-red-500' :
                        type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500'
                    }`;
                    notification.innerHTML = `
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-${type === 'success' ? 'check' : type === 'error' ? 'exclamation' : 'info'}"></i>
                            <span>${message}</span>
                        </div>
                    `;
                    
                    document.getElementById('notifications').appendChild(notification);
                    
                    setTimeout(() => {
                        notification.style.transition = 'opacity 0.3s';
                        notification.style.opacity = '0';
                        setTimeout(() => notification.remove(), 300);
                    }, 3000);
                }
            }));
        });
    </script>
</body>
</html>
